document,window,jarallax(document.querySelectorAll(".jarallax")),function(){"use strict";let i=void 0;function n(l,a){return new Promise(e=>{const t=()=>{a.removeEventListener("transitionend",t),e()};a.addEventListener("transitionend",t);var s=a.getAttribute("class"),i=a.getAttribute("style");l(),s===a.getAttribute("class")&&i===a.getAttribute("style")&&t(),0===parseFloat(getComputedStyle(a).transitionDuration)&&t()})}function o({src:e,srcset:t,sizes:s}){const i=new Image;return i.src=e,t&&(i.srcset=t),s&&(i.sizes=s),"decode"in i?new Promise((e,t)=>{i.decode().then(()=>{e(i)}).catch(()=>{t(i)})}):new Promise((e,t)=>{i.onload=e(i),i.onerror=t(i)})}function l(e){let t,s;var{imgHeight:i,imgWidth:l,containerHeight:a,containerWidth:n,canvasWidth:o,canvasHeight:c,imageSize:h}=e,e=i/l;return"cover"==h?e<a/n?(t=a,s=t/e):(s=n,t=s*e):"native"==h?(t=i,s=l):(c/o<e?(t=c,s=t/e):(s=o,t=s*e),"scale-down"===h&&(s>=l||t>=i)&&(s=l,t=i)),{height:t,width:s}}function c(e){return e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():Promise.reject()}function a(){return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():Promise.reject()}const s={container:document.body,className:void 0,imageSize:"scale-down",fullScreen:!1,loop:!1,linkImages:!0,setIndex:0,firstImageIndex:0,lastImageIndex:!1,currentImageIndex:void 0,allowZoom:!0,closeOnBackgroundClick:!0,setTitle:function(){return""},description:function(){return this.images[this.settings.currentImageIndex].title},pagination:function(){var e=this.settings.lastImageIndex+1;return this.settings.currentImageIndex+1+"/"+e},afterInitialize(){},afterMarkup(){},afterImageLoad(){},afterClose(){},zoomedPaddingX:function(e,t){return 0},zoomedPaddingY:function(e,t){return 0}};class h{constructor(e,t){this.settings=t,this.elems={},this.images=[],this.events=[],this.state={fullScreenOpen:!1,initialZoomState:null,initialized:!1,timer:!1,visible:!1},this._cssClasses=["chocolat-open","chocolat-in-container","chocolat-cover","chocolat-zoomable","chocolat-zoomed","chocolat-zooming-in","chocolat-zooming-out"],NodeList.prototype.isPrototypeOf(e)||HTMLCollection.prototype.isPrototypeOf(e)?e.forEach((e,t)=>{this.images.push({title:e.getAttribute("title"),src:e.getAttribute("href"),srcset:e.getAttribute("data-srcset"),sizes:e.getAttribute("data-sizes")}),this.off(e,"click.chocolat"),this.on(e,"click.chocolat",e=>{this.init(t),e.preventDefault()})}):this.images=e,this.settings.container instanceof Element||this.settings.container instanceof HTMLElement?this.elems.container=this.settings.container:this.elems.container=document.body,this.api={open:e=>(e=parseInt(e)||0,this.init(e)),close:()=>this.close(),next:()=>this.change(1),prev:()=>this.change(-1),goto:e=>this.open(e),current:()=>this.settings.currentImageIndex,position:()=>this.position(this.elems.img),destroy:()=>this.destroy(),set:(e,t)=>this.settings[e]=t,get:e=>this.settings[e],getElem:e=>this.elems[e]}}init(e){return this.state.initialized||(this.markup(),this.attachListeners(),this.settings.lastImageIndex=this.images.length-1,this.state.initialized=!0),this.settings.afterInitialize.call(this),this.load(e)}load(t){if(this.state.visible||(this.state.visible=!0,setTimeout(()=>{this.elems.overlay.classList.add("chocolat-visible"),this.elems.wrapper.classList.add("chocolat-visible")},0),this.elems.container.classList.add("chocolat-open")),this.settings.fullScreen&&(this.state.fullScreenOpen=c(this.elems.wrapper)),this.settings.currentImageIndex===t)return Promise.resolve();let s=setTimeout(()=>{this.elems.loader.classList.add("chocolat-visible")},1e3),i,l,a=setTimeout(()=>{a=void 0,i=n(()=>{this.elems.imageCanvas.classList.remove("chocolat-visible")},this.elems.imageCanvas)},80);return o(this.images[t]).then(e=>(l=e,a?(clearTimeout(a),Promise.resolve()):i)).then(()=>{var e=t+1;return null!=this.images[e]&&o(this.images[e]),this.settings.currentImageIndex=t,this.elems.description.textContent=this.settings.description.call(this),this.elems.pagination.textContent=this.settings.pagination.call(this),this.arrows(),this.position(l).then(()=>(this.elems.loader.classList.remove("chocolat-visible"),clearTimeout(s),this.appear(l)))}).then(()=>{this.elems.container.classList.toggle("chocolat-zoomable",this.zoomable(l,this.elems.wrapper)),this.settings.afterImageLoad.call(this)})}position({naturalHeight:e,naturalWidth:t}){const{width:s,height:i}=l({imgHeight:e,imgWidth:t,containerHeight:this.elems.container.clientHeight,containerWidth:this.elems.container.clientWidth,canvasWidth:this.elems.imageCanvas.clientWidth,canvasHeight:this.elems.imageCanvas.clientHeight,imageSize:this.settings.imageSize});return n(()=>{Object.assign(this.elems.imageWrapper.style,{width:s+"px",height:i+"px"})},this.elems.imageWrapper)}appear(e){return this.elems.imageWrapper.removeChild(this.elems.img),this.elems.img=e,this.elems.img.setAttribute("class","chocolat-img"),this.elems.imageWrapper.appendChild(this.elems.img),n(()=>{this.elems.imageCanvas.classList.add("chocolat-visible")},this.elems.imageCanvas)}change(e){if(this.state.visible&&this.settings.linkImages){this.zoomOut();e=this.settings.currentImageIndex+parseInt(e);return e>this.settings.lastImageIndex?this.settings.loop?this.load(this.settings.firstImageIndex):void 0:e<this.settings.firstImageIndex?this.settings.loop?this.load(this.settings.lastImageIndex):void 0:this.load(e)}}arrows(){this.settings.loop?(this.elems.left.classList.add("active"),this.elems.right.classList.add("active")):this.settings.linkImages?(this.elems.right.classList.toggle("active",this.settings.currentImageIndex!==this.settings.lastImageIndex),this.elems.left.classList.toggle("active",this.settings.currentImageIndex!==this.settings.firstImageIndex)):(this.elems.left.classList.remove("active"),this.elems.right.classList.remove("active"))}close(){if(!this.state.fullScreenOpen){this.state.visible=!1;var e=n(()=>{this.elems.overlay.classList.remove("chocolat-visible")},this.elems.overlay),t=n(()=>{this.elems.wrapper.classList.remove("chocolat-visible")},this.elems.wrapper);return Promise.all([e,t]).then(()=>{this.elems.container.classList.remove("chocolat-open"),this.settings.afterClose.call(this)})}a()}destroy(){for(let e=this.events.length-1;0<=e;e--){var{element:t,eventName:s}=this.events[e];this.off(t,s)}this.state.initialized&&(this.state.fullScreenOpen&&(this.state.fullScreenOpen=a()),this.settings.currentImageIndex=void 0,this.state.visible=!1,this.state.initialized=!1,this.elems.container.classList.remove(...this._cssClasses),this.elems.wrapper.parentNode.removeChild(this.elems.wrapper))}markup(){this.elems.container.classList.add("chocolat-open",this.settings.className),"cover"==this.settings.imageSize&&this.elems.container.classList.add("chocolat-cover"),this.elems.container!==document.body&&this.elems.container.classList.add("chocolat-in-container"),this.elems.wrapper=document.createElement("div"),this.elems.wrapper.setAttribute("id","chocolat-content-"+this.settings.setIndex),this.elems.wrapper.setAttribute("class","chocolat-wrapper"),this.elems.container.appendChild(this.elems.wrapper),this.elems.overlay=document.createElement("div"),this.elems.overlay.setAttribute("class","chocolat-overlay"),this.elems.wrapper.appendChild(this.elems.overlay),this.elems.loader=document.createElement("div"),this.elems.loader.setAttribute("class","chocolat-loader"),this.elems.wrapper.appendChild(this.elems.loader),this.elems.layout=document.createElement("div"),this.elems.layout.setAttribute("class","chocolat-layout"),this.elems.wrapper.appendChild(this.elems.layout),this.elems.top=document.createElement("div"),this.elems.top.setAttribute("class","chocolat-top"),this.elems.layout.appendChild(this.elems.top),this.elems.center=document.createElement("div"),this.elems.center.setAttribute("class","chocolat-center"),this.elems.layout.appendChild(this.elems.center),this.elems.left=document.createElement("div"),this.elems.left.setAttribute("class","chocolat-left"),this.elems.center.appendChild(this.elems.left),this.elems.imageCanvas=document.createElement("div"),this.elems.imageCanvas.setAttribute("class","chocolat-image-canvas"),this.elems.center.appendChild(this.elems.imageCanvas),this.elems.imageWrapper=document.createElement("div"),this.elems.imageWrapper.setAttribute("class","chocolat-image-wrapper"),this.elems.imageCanvas.appendChild(this.elems.imageWrapper),this.elems.img=document.createElement("img"),this.elems.img.setAttribute("class","chocolat-img"),this.elems.imageWrapper.appendChild(this.elems.img),this.elems.right=document.createElement("div"),this.elems.right.setAttribute("class","chocolat-right"),this.elems.center.appendChild(this.elems.right),this.elems.bottom=document.createElement("div"),this.elems.bottom.setAttribute("class","chocolat-bottom"),this.elems.layout.appendChild(this.elems.bottom),this.elems.close=document.createElement("span"),this.elems.close.setAttribute("class","chocolat-close"),this.elems.top.appendChild(this.elems.close),this.elems.description=document.createElement("span"),this.elems.description.setAttribute("class","chocolat-description"),this.elems.bottom.appendChild(this.elems.description),this.elems.pagination=document.createElement("span"),this.elems.pagination.setAttribute("class","chocolat-pagination"),this.elems.bottom.appendChild(this.elems.pagination),this.elems.setTitle=document.createElement("span"),this.elems.setTitle.setAttribute("class","chocolat-set-title"),this.elems.setTitle.textContent=this.settings.setTitle(),this.elems.bottom.appendChild(this.elems.setTitle),this.elems.fullscreen=document.createElement("span"),this.elems.fullscreen.setAttribute("class","chocolat-fullscreen"),this.elems.bottom.appendChild(this.elems.fullscreen),this.settings.afterMarkup.call(this)}attachListeners(){this.off(document,"keydown.chocolat"),this.on(document,"keydown.chocolat",e=>{this.state.initialized&&(37==e.keyCode?this.change(-1):39==e.keyCode?this.change(1):27==e.keyCode&&this.close())});var e=this.elems.wrapper.querySelector(".chocolat-right");this.off(e,"click.chocolat"),this.on(e,"click.chocolat",()=>{this.change(1)});e=this.elems.wrapper.querySelector(".chocolat-left");this.off(e,"click.chocolat"),this.on(e,"click.chocolat",()=>{this.change(-1)}),this.off(this.elems.close,"click.chocolat"),this.on(this.elems.close,"click.chocolat",this.close.bind(this)),this.off(this.elems.fullscreen,"click.chocolat"),this.on(this.elems.fullscreen,"click.chocolat",()=>{this.state.fullScreenOpen?a():c(this.elems.wrapper)}),this.off(document,"fullscreenchange.chocolat"),this.on(document,"fullscreenchange.chocolat",()=>{document.fullscreenElement?this.state.fullScreenOpen=!0:this.state.fullScreenOpen=!1}),this.settings.closeOnBackgroundClick&&(this.off(this.elems.overlay,"click.chocolat"),this.on(this.elems.overlay,"click.chocolat",this.close.bind(this))),this.off(this.elems.wrapper,"click.chocolat"),this.on(this.elems.wrapper,"click.chocolat",()=>{null!==this.state.initialZoomState&&this.state.visible&&(this.elems.container.classList.add("chocolat-zooming-out"),this.zoomOut().then(()=>{this.elems.container.classList.remove("chocolat-zoomed"),this.elems.container.classList.remove("chocolat-zooming-out")}))}),this.off(this.elems.imageWrapper,"click.chocolat"),this.on(this.elems.imageWrapper,"click.chocolat",e=>{null===this.state.initialZoomState&&this.elems.container.classList.contains("chocolat-zoomable")&&(e.stopPropagation(),this.elems.container.classList.add("chocolat-zooming-in"),this.zoomIn(e).then(()=>{this.elems.container.classList.add("chocolat-zoomed"),this.elems.container.classList.remove("chocolat-zooming-in")}))}),this.on(this.elems.wrapper,"mousemove.chocolat",s=>{if(null!==this.state.initialZoomState&&this.state.visible){var i,l=this.elems.wrapper.getBoundingClientRect(),a={top:l.top+window.scrollY,left:l.left+window.scrollX},n=this.elems.wrapper.clientHeight,o=this.elems.wrapper.clientWidth,c=this.elems.img.width,l=this.elems.img.height,a=[s.pageX-o/2-a.left,s.pageY-n/2-a.top];let e=0;o<c&&(i=this.settings.zoomedPaddingX(c,o),e=a[0]/(o/2),e*=(c-o)/2+i);let t=0;n<l&&(i=this.settings.zoomedPaddingY(l,n),t=a[1]/(n/2),t*=(l-n)/2+i),this.elems.img.style.marginLeft=-e+"px",this.elems.img.style.marginTop=-t+"px"}}),this.on(window,"resize.chocolat",e=>{var t,s;this.state.initialized&&this.state.visible&&(t=50,s=()=>{var{}=l({imgHeight:this.elems.img.naturalHeight,imgWidth:this.elems.img.naturalWidth,containerHeight:this.elems.wrapper.clientHeight,containerWidth:this.elems.wrapper.clientWidth,canvasWidth:this.elems.imageCanvas.clientWidth,canvasHeight:this.elems.imageCanvas.clientHeight,imageSize:this.settings.imageSize});this.position(this.elems.img).then(()=>{this.elems.container.classList.toggle("chocolat-zoomable",this.zoomable(this.elems.img,this.elems.wrapper))})},clearTimeout(i),i=setTimeout(function(){s()},t),i)})}zoomable(e,t){var s=t.clientWidth,t=t.clientHeight,t=!(!this.settings.allowZoom||!(e.naturalWidth>s||e.naturalHeight>t)),e=e.clientWidth>e.naturalWidth||e.clientHeight>e.naturalHeight;return t&&!e}zoomIn(e){return this.state.initialZoomState=this.settings.imageSize,this.settings.imageSize="native",this.position(this.elems.img)}zoomOut(e){return this.settings.imageSize=this.state.initialZoomState||this.settings.imageSize,this.state.initialZoomState=null,this.elems.img.style.margin=0,this.position(this.elems.img)}on(e,t,s){s=this.events.push({element:e,eventName:t,cb:s});e.addEventListener(t.split(".")[0],this.events[s-1].cb)}off(t,s){var e=this.events.findIndex(e=>e.element===t&&e.eventName===s);this.events[e]&&(t.removeEventListener(s.split(".")[0],this.events[e].cb),this.events.splice(e,1))}}const r=[];window.Chocolat=function(e,t){t=Object.assign({},s,{images:[]},t,{setIndex:r.length}),t=new h(e,t);return r.push(t),t}}(),(e=>{if(!window.IntersectionObserver){console.log("observers not supported");const t=e.querySelectorAll("fade");t.forEach(e=>{e.classList.remove("fade"),e.classList.contains("fade-in")&&e.classList.remove("fade-in"),e.classList.contains("swipe-left")&&e.classList.remove("swipe-left"),e.classList.contains("swipe-right")&&e.classList.remove("swipe-right"),e.classList.contains("swipe-up")&&e.classList.remove("swipe-up")})}if(window.IntersectionObserver){const s=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.contains("fade-in")&&e.target.classList.add("appear"),e.target.classList.contains("swipe-left")&&e.target.classList.add("position"),e.target.classList.contains("swipe-right")&&e.target.classList.add("position"),e.target.classList.contains("swipe-up")&&e.target.classList.add("position"),e.target.classList.contains("swipe-down")&&e.target.classList.add("position"),t.unobserve(e.target))})},{threshold:0,rootMargin:"0px 0px -150px 0px"}),i=e.querySelectorAll(".fade"),l=e.querySelectorAll(".fade-stagger");l.forEach(s=>{s.querySelectorAll(".fade").forEach((e,t)=>{e.style.transitionDelay=`${((e,t,s)=>{const i=getComputedStyle(e);return"grid"==i.getPropertyValue("display")?s%i.getPropertyValue("grid-template-columns").split(" ").length*t:s*t})(s,.25,t)}s`})}),i.forEach(e=>{s.observe(e)}),i.forEach(e=>{s.observe(e)})}})(document,window);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNob2NvbGF0LmpzIiwiaW50ZXJzZWN0aW9uLW9ic2VydmVycy5qcyJdLCJuYW1lcyI6WyJkb2N1bWVudCIsIndpbmRvdyIsImphcmFsbGF4IiwicXVlcnlTZWxlY3RvckFsbCIsInRpbWVyRGVib3VuY2UiLCJ1bmRlZmluZWQiLCJ0cmFuc2l0aW9uQXNQcm9taXNlIiwidHJpZ2dlcmluZ0Z1bmMiLCJlbCIsIlByb21pc2UiLCJyZXNvbHZlIiwiaGFuZGxlVHJhbnNpdGlvbkVuZCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiY2xhc3Nlc0JlZm9yZSIsImdldEF0dHJpYnV0ZSIsInN0eWxlc0JlZm9yZSIsInBhcnNlRmxvYXQiLCJnZXRDb21wdXRlZFN0eWxlIiwibG9hZEltYWdlIiwic3JjIiwic3Jjc2V0Iiwic2l6ZXMiLCJpbWFnZSIsIkltYWdlIiwicmVqZWN0IiwiZGVjb2RlIiwidGhlbiIsImNhdGNoIiwib25sb2FkIiwib25lcnJvciIsImZpdCIsIm9wdGlvbnMiLCJoZWlnaHQiLCJ3aWR0aCIsImltZ0hlaWdodCIsImltZ1dpZHRoIiwiY29udGFpbmVySGVpZ2h0IiwiY29udGFpbmVyV2lkdGgiLCJjYW52YXNXaWR0aCIsImNhbnZhc0hlaWdodCIsImltYWdlU2l6ZSIsImltZ1JhdGlvIiwib3BlbkZ1bGxTY3JlZW4iLCJ3cmFwcGVyIiwicmVxdWVzdEZ1bGxzY3JlZW4iLCJ3ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbiIsIm1zUmVxdWVzdEZ1bGxzY3JlZW4iLCJleGl0RnVsbFNjcmVlbiIsImV4aXRGdWxsc2NyZWVuIiwid2Via2l0RXhpdEZ1bGxzY3JlZW4iLCJtc0V4aXRGdWxsc2NyZWVuIiwiZGVmYXVsdHMiLCJjb250YWluZXIiLCJib2R5IiwiY2xhc3NOYW1lIiwiZnVsbFNjcmVlbiIsImxvb3AiLCJsaW5rSW1hZ2VzIiwic2V0SW5kZXgiLCJmaXJzdEltYWdlSW5kZXgiLCJsYXN0SW1hZ2VJbmRleCIsImN1cnJlbnRJbWFnZUluZGV4IiwiYWxsb3dab29tIiwiY2xvc2VPbkJhY2tncm91bmRDbGljayIsInNldFRpdGxlIiwiZGVzY3JpcHRpb24iLCJ0aGlzIiwiaW1hZ2VzIiwic2V0dGluZ3MiLCJ0aXRsZSIsInBhZ2luYXRpb24iLCJsYXN0IiwiYWZ0ZXJJbml0aWFsaXplIiwiYWZ0ZXJNYXJrdXAiLCJhZnRlckltYWdlTG9hZCIsImFmdGVyQ2xvc2UiLCJ6b29tZWRQYWRkaW5nWCIsInpvb21lZFBhZGRpbmdZIiwiQ2hvY29sYXQiLCJlbGVtZW50cyIsImVsZW1zIiwiZXZlbnRzIiwic3RhdGUiLCJmdWxsU2NyZWVuT3BlbiIsImluaXRpYWxab29tU3RhdGUiLCJpbml0aWFsaXplZCIsInRpbWVyIiwidmlzaWJsZSIsIl9jc3NDbGFzc2VzIiwiTm9kZUxpc3QiLCJwcm90b3R5cGUiLCJpc1Byb3RvdHlwZU9mIiwiSFRNTENvbGxlY3Rpb24iLCJmb3JFYWNoIiwiaSIsInB1c2giLCJvZmYiLCJvbiIsImUiLCJpbml0IiwicHJldmVudERlZmF1bHQiLCJFbGVtZW50IiwiSFRNTEVsZW1lbnQiLCJhcGkiLCJvcGVuIiwicGFyc2VJbnQiLCJjbG9zZSIsIm5leHQiLCJjaGFuZ2UiLCJwcmV2IiwiZ290byIsImN1cnJlbnQiLCJwb3NpdGlvbiIsImltZyIsImRlc3Ryb3kiLCJzZXQiLCJwcm9wZXJ0eSIsInZhbHVlIiwiZ2V0IiwiZ2V0RWxlbSIsIm5hbWUiLCJtYXJrdXAiLCJhdHRhY2hMaXN0ZW5lcnMiLCJsZW5ndGgiLCJjYWxsIiwibG9hZCIsImluZGV4Iiwic2V0VGltZW91dCIsIm92ZXJsYXkiLCJjbGFzc0xpc3QiLCJhZGQiLCJsb2FkZXJUaW1lciIsImxvYWRlciIsImZhZGVPdXRQcm9taXNlIiwiZmFkZU91dFRpbWVyIiwiaW1hZ2VDYW52YXMiLCJyZW1vdmUiLCJsb2FkZWRJbWFnZSIsImNsZWFyVGltZW91dCIsIm5leHRJbmRleCIsInRleHRDb250ZW50IiwiYXJyb3dzIiwiYXBwZWFyIiwidG9nZ2xlIiwiem9vbWFibGUiLCJuYXR1cmFsSGVpZ2h0IiwibmF0dXJhbFdpZHRoIiwiY2xpZW50SGVpZ2h0IiwiY2xpZW50V2lkdGgiLCJPYmplY3QiLCJhc3NpZ24iLCJpbWFnZVdyYXBwZXIiLCJzdHlsZSIsInJlbW92ZUNoaWxkIiwic2V0QXR0cmlidXRlIiwiYXBwZW5kQ2hpbGQiLCJzdGVwIiwiem9vbU91dCIsInJlcXVlc3RlZEltYWdlIiwibGVmdCIsInJpZ2h0IiwicHJvbWlzZU92ZXJsYXkiLCJwcm9taXNlV3JhcHBlciIsImFsbCIsImVsZW1lbnQiLCJldmVudE5hbWUiLCJwYXJlbnROb2RlIiwiY3JlYXRlRWxlbWVudCIsImxheW91dCIsInRvcCIsImNlbnRlciIsImJvdHRvbSIsImZ1bGxzY3JlZW4iLCJrZXlDb2RlIiwicXVlcnlTZWxlY3RvciIsImJpbmQiLCJmdWxsc2NyZWVuRWxlbWVudCIsImNvbnRhaW5zIiwic3RvcFByb3BhZ2F0aW9uIiwiem9vbUluIiwicGFkZGluZ1kiLCJyZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwicG9zIiwic2Nyb2xsWSIsInNjcm9sbFgiLCJjb29yZCIsInBhZ2VYIiwicGFnZVkiLCJtdnRYIiwicGFkZGluZ1giLCJtdnRZIiwibWFyZ2luTGVmdCIsIm1hcmdpblRvcCIsImR1cmF0aW9uIiwiY2FsbGJhY2siLCJ3cmFwcGVyV2lkdGgiLCJ3cmFwcGVySGVpZ2h0IiwiaXNJbWFnZVpvb21hYmxlIiwiaXNJbWFnZVN0cmV0Y2hlZCIsIm1hcmdpbiIsImNiIiwic3BsaXQiLCJmaW5kSW5kZXgiLCJldmVudCIsInNwbGljZSIsImluc3RhbmNlcyIsImluc3RhbmNlIiwiZCIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwiY29uc29sZSIsImxvZyIsIm9ic2VydmVkQ29udGVudCIsImVsZW0iLCJhcHBlYXJPblNjcm9sbCIsImVudHJpZXMiLCJlbnRyeSIsImlzSW50ZXJzZWN0aW5nIiwidGFyZ2V0IiwidW5vYnNlcnZlIiwidGhyZXNob2xkIiwicm9vdE1hcmdpbiIsImZhZGVycyIsInN0YWdnZXJzIiwiZ3JvdXAiLCJ0cmFuc2l0aW9uRGVsYXkiLCJnZXRQcm9wZXJ0eVZhbHVlIiwic2V0RGVsYXkiLCJvYnNlcnZlIiwiZmFkZXIiXSwibWFwcGluZ3MiOiJBQUVBQSxTQUFBQyxPQURBQyxTQUFBRixTQUFBRyxpQkFBQSxjQ0RBLHdCQUdBLElBQUFDLE9BQUFDLEVBUUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FDQSxPQUFBLElBQUFDLFFBQUFDLElBQ0EsTUFBQUMsRUFBQSxLQUNBSCxFQUFBSSxvQkFBQSxnQkFBQUQsR0FDQUQsS0FHQUYsRUFBQUssaUJBQUEsZ0JBQUFGLEdBQ0EsSUFBQUcsRUFBQU4sRUFBQU8sYUFBQSxTQUNBQyxFQUFBUixFQUFBTyxhQUFBLFNBQ0FSLElBRUFPLElBQUFOLEVBQUFPLGFBQUEsVUFBQUMsSUFBQVIsRUFBQU8sYUFBQSxVQUNBSixJQUdBLElBQUFNLFdBQUFDLGlCQUFBVixHQUFBLHFCQUNBRyxNQUlBLFNBQUFRLEVBQUEsQ0FDQUMsSUFBQUEsRUFDQUMsT0FBQUEsRUFDQUMsTUFBQUEsSUFFQSxNQUFBQyxFQUFBLElBQUFDLE1BV0EsT0FWQUQsRUFBQUgsSUFBQUEsRUFFQUMsSUFDQUUsRUFBQUYsT0FBQUEsR0FHQUMsSUFDQUMsRUFBQUQsTUFBQUEsR0FHQSxXQUFBQyxFQUNBLElBQUFkLFFBQUEsQ0FBQUMsRUFBQWUsS0FDQUYsRUFBQUcsU0FBQUMsS0FBQSxLQUNBakIsRUFBQWEsS0FDQUssTUFBQSxLQUNBSCxFQUFBRixPQUlBLElBQUFkLFFBQUEsQ0FBQUMsRUFBQWUsS0FDQUYsRUFBQU0sT0FBQW5CLEVBQUFhLEdBQ0FBLEVBQUFPLFFBQUFMLEVBQUFGLEtBSUEsU0FBQVEsRUFBQUMsR0FDQSxJQUFBQyxFQUNBQyxFQUNBLEdBQUEsQ0FDQUMsVUFBQUEsRUFDQUMsU0FBQUEsRUFDQUMsZ0JBQUFBLEVBQ0FDLGVBQUFBLEVBQ0FDLFlBQUFBLEVBQ0FDLGFBQUFBLEVBQ0FDLFVBQUFBLEdBQ0FU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QSxDQUFBRCxFQUFBOUIsRUFBQXBHLEtBQ0EsTUFBQTBELEVBQUF2SSxpQkFBQStNLEdBR0EsTUFGQSxRQUFBeEUsRUFBQTBFLGlCQUFBLFdBT0FwSSxFQUpBMEQsRUFDQTBFLGlCQUFBLHlCQUNBeEIsTUFBQSxLQUFBL0UsT0FFQXVFLEVBR0FwRyxFQUFBb0csR0FPQWlDLENBQUFILEVBSEEsSUFHQWxHLFVBSUFnRyxFQUFBakksUUFBQSxJQUNBeUgsRUFBQWMsUUFBQUMsS0FFQVAsRUFBQWpJLFFBQUEsSUFDQXlILEVBQUFjLFFBQUFDLE9BdEZBLENBeUZBdE8sU0FBQUMiLCJmaWxlIjoiYWxsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIigoZCwgdykgPT4ge1xuICBqYXJhbGxheChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmphcmFsbGF4XCIpKTtcbn0pKGRvY3VtZW50LCB3aW5kb3cpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBsZXQgdGltZXJEZWJvdW5jZSA9IHVuZGVmaW5lZDtcbiAgICBmdW5jdGlvbiBkZWJvdW5jZShkdXJhdGlvbiwgY2FsbGJhY2spIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lckRlYm91bmNlKTtcbiAgICAgIHRpbWVyRGVib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH0sIGR1cmF0aW9uKTtcbiAgICAgIHJldHVybiB0aW1lckRlYm91bmNlO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0cmFuc2l0aW9uQXNQcm9taXNlKHRyaWdnZXJpbmdGdW5jLCBlbCkge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICBjb25zdCBoYW5kbGVUcmFuc2l0aW9uRW5kID0gKCkgPT4ge1xuICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCBoYW5kbGVUcmFuc2l0aW9uRW5kKTtcbiAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsIGhhbmRsZVRyYW5zaXRpb25FbmQpO1xuICAgICAgICBjb25zdCBjbGFzc2VzQmVmb3JlID0gZWwuZ2V0QXR0cmlidXRlKCdjbGFzcycpO1xuICAgICAgICBjb25zdCBzdHlsZXNCZWZvcmUgPSBlbC5nZXRBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gICAgICAgIHRyaWdnZXJpbmdGdW5jKCk7XG5cbiAgICAgICAgaWYgKGNsYXNzZXNCZWZvcmUgPT09IGVsLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSAmJiBzdHlsZXNCZWZvcmUgPT09IGVsLmdldEF0dHJpYnV0ZSgnc3R5bGUnKSkge1xuICAgICAgICAgIGhhbmRsZVRyYW5zaXRpb25FbmQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYXJzZUZsb2F0KGdldENvbXB1dGVkU3R5bGUoZWwpWyd0cmFuc2l0aW9uRHVyYXRpb24nXSkgPT09IDApIHtcbiAgICAgICAgICBoYW5kbGVUcmFuc2l0aW9uRW5kKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBmdW5jdGlvbiBsb2FkSW1hZ2Uoe1xuICAgICAgc3JjLFxuICAgICAgc3Jjc2V0LFxuICAgICAgc2l6ZXNcbiAgICB9KSB7XG4gICAgICBjb25zdCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgaW1hZ2Uuc3JjID0gc3JjO1xuXG4gICAgICBpZiAoc3Jjc2V0KSB7XG4gICAgICAgIGltYWdlLnNyY3NldCA9IHNyY3NldDtcbiAgICAgIH1cblxuICAgICAgaWYgKHNpemVzKSB7XG4gICAgICAgIGltYWdlLnNpemVzID0gc2l6ZXM7XG4gICAgICB9XG5cbiAgICAgIGlmICgnZGVjb2RlJyBpbiBpbWFnZSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIGltYWdlLmRlY29kZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgcmVzb2x2ZShpbWFnZSk7XG4gICAgICAgICAgfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KGltYWdlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIGltYWdlLm9ubG9hZCA9IHJlc29sdmUoaW1hZ2UpO1xuICAgICAgICAgIGltYWdlLm9uZXJyb3IgPSByZWplY3QoaW1hZ2UpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gZml0KG9wdGlvbnMpIHtcbiAgICAgIGxldCBoZWlnaHQ7XG4gICAgICBsZXQgd2lkdGg7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGltZ0hlaWdodCxcbiAgICAgICAgaW1nV2lkdGgsXG4gICAgICAgIGNvbnRhaW5lckhlaWdodCxcbiAgICAgICAgY29udGFpbmVyV2lkdGgsXG4gICAgICAgIGNhbnZhc1dpZHRoLFxuICAgICAgICBjYW52YXNIZWlnaHQsXG4gICAgICAgIGltYWdlU2l6ZVxuICAgICAgfSA9IG9wdGlvbnM7XG4gICAgICBjb25zdCBjYW52YXNSYXRpbyA9IGNhbnZhc0hlaWdodCAvIGNhbnZhc1dpZHRoO1xuICAgICAgY29uc3QgY29udGFpbmVyUmF0aW8gPSBjb250YWluZXJIZWlnaHQgLyBjb250YWluZXJXaWR0aDtcbiAgICAgIGNvbnN0IGltZ1JhdGlvID0gaW1nSGVpZ2h0IC8gaW1nV2lkdGg7XG5cbiAgICAgIGlmIChpbWFnZVNpemUgPT0gJ2NvdmVyJykge1xuICAgICAgICBpZiAoaW1nUmF0aW8gPCBjb250YWluZXJSYXRpbykge1xuICAgICAgICAgIGhlaWdodCA9IGNvbnRhaW5lckhlaWdodDtcbiAgICAgICAgICB3aWR0aCA9IGhlaWdodCAvIGltZ1JhdGlvO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdpZHRoID0gY29udGFpbmVyV2lkdGg7XG4gICAgICAgICAgaGVpZ2h0ID0gd2lkdGggKiBpbWdSYXRpbztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChpbWFnZVNpemUgPT0gJ25hdGl2ZScpIHtcbiAgICAgICAgaGVpZ2h0ID0gaW1nSGVpZ2h0O1xuICAgICAgICB3aWR0aCA9IGltZ1dpZHRoO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGltZ1JhdGlvID4gY2FudmFzUmF0aW8pIHtcbiAgICAgICAgICBoZWlnaHQgPSBjYW52YXNIZWlnaHQ7XG4gICAgICAgICAgd2lkdGggPSBoZWlnaHQgLyBpbWdSYXRpbztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3aWR0aCA9IGNhbnZhc1dpZHRoO1xuICAgICAgICAgIGhlaWdodCA9IHdpZHRoICogaW1nUmF0aW87XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW1hZ2VTaXplID09PSAnc2NhbGUtZG93bicgJiYgKHdpZHRoID49IGltZ1dpZHRoIHx8IGhlaWdodCA+PSBpbWdIZWlnaHQpKSB7XG4gICAgICAgICAgd2lkdGggPSBpbWdXaWR0aDtcbiAgICAgICAgICBoZWlnaHQgPSBpbWdIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgIHdpZHRoOiB3aWR0aFxuICAgICAgfTtcbiAgICB9XG4gICAgZnVuY3Rpb24gb3BlbkZ1bGxTY3JlZW4od3JhcHBlcikge1xuICAgICAgaWYgKHdyYXBwZXIucmVxdWVzdEZ1bGxzY3JlZW4pIHtcbiAgICAgICAgcmV0dXJuIHdyYXBwZXIucmVxdWVzdEZ1bGxzY3JlZW4oKTtcbiAgICAgIH0gZWxzZSBpZiAod3JhcHBlci53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikge1xuICAgICAgICByZXR1cm4gd3JhcHBlci53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIGlmICh3cmFwcGVyLm1zUmVxdWVzdEZ1bGxzY3JlZW4pIHtcbiAgICAgICAgcmV0dXJuIHdyYXBwZXIubXNSZXF1ZXN0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG4gICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIGV4aXRGdWxsU2NyZWVuKCkge1xuICAgICAgaWYgKGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKSB7XG4gICAgICAgIHJldHVybiBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbikge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4oKTtcbiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbikge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgICBjb250YWluZXI6IGRvY3VtZW50LmJvZHksXG4gICAgICAvLyB3aW5kb3cgb3IgZWxlbWVudFxuICAgICAgY2xhc3NOYW1lOiB1bmRlZmluZWQsXG4gICAgICBpbWFnZVNpemU6ICdzY2FsZS1kb3duJyxcbiAgICAgIC8vICdzY2FsZS1kb3duJywgJ2NvbnRhaW4nLCAnY292ZXInIG9yICduYXRpdmUnXG4gICAgICBmdWxsU2NyZWVuOiBmYWxzZSxcbiAgICAgIGxvb3A6IGZhbHNlLFxuICAgICAgbGlua0ltYWdlczogdHJ1ZSxcbiAgICAgIHNldEluZGV4OiAwLFxuICAgICAgZmlyc3RJbWFnZUluZGV4OiAwLFxuICAgICAgbGFzdEltYWdlSW5kZXg6IGZhbHNlLFxuICAgICAgY3VycmVudEltYWdlSW5kZXg6IHVuZGVmaW5lZCxcbiAgICAgIGFsbG93Wm9vbTogdHJ1ZSxcbiAgICAgIGNsb3NlT25CYWNrZ3JvdW5kQ2xpY2s6IHRydWUsXG4gICAgICBzZXRUaXRsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgICB9LFxuICAgICAgZGVzY3JpcHRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1hZ2VzW3RoaXMuc2V0dGluZ3MuY3VycmVudEltYWdlSW5kZXhdLnRpdGxlO1xuICAgICAgfSxcbiAgICAgIHBhZ2luYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgbGFzdCA9IHRoaXMuc2V0dGluZ3MubGFzdEltYWdlSW5kZXggKyAxO1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMuc2V0dGluZ3MuY3VycmVudEltYWdlSW5kZXggKyAxO1xuICAgICAgICByZXR1cm4gcG9zaXRpb24gKyAnLycgKyBsYXN0O1xuICAgICAgfSxcblxuICAgICAgYWZ0ZXJJbml0aWFsaXplKCkge30sXG5cbiAgICAgIGFmdGVyTWFya3VwKCkge30sXG5cbiAgICAgIGFmdGVySW1hZ2VMb2FkKCkge30sXG5cbiAgICAgIGFmdGVyQ2xvc2UoKSB7fSxcblxuICAgICAgem9vbWVkUGFkZGluZ1g6IGZ1bmN0aW9uIChjYW52YXNXaWR0aCwgaW1nV2lkdGgpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9LFxuICAgICAgem9vbWVkUGFkZGluZ1k6IGZ1bmN0aW9uIChjYW52YXNIZWlnaHQsIGltZ0hlaWdodCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICB9O1xuICAgIGNsYXNzIENob2NvbGF0IHtcbiAgICAgIGNvbnN0cnVjdG9yKGVsZW1lbnRzLCBzZXR0aW5ncykge1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gICAgICAgIHRoaXMuZWxlbXMgPSB7fTtcbiAgICAgICAgdGhpcy5pbWFnZXMgPSBbXTtcbiAgICAgICAgdGhpcy5ldmVudHMgPSBbXTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICBmdWxsU2NyZWVuT3BlbjogZmFsc2UsXG4gICAgICAgICAgaW5pdGlhbFpvb21TdGF0ZTogbnVsbCxcbiAgICAgICAgICBpbml0aWFsaXplZDogZmFsc2UsXG4gICAgICAgICAgdGltZXI6IGZhbHNlLFxuICAgICAgICAgIHZpc2libGU6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2Nzc0NsYXNzZXMgPSBbJ2Nob2NvbGF0LW9wZW4nLCAnY2hvY29sYXQtaW4tY29udGFpbmVyJywgJ2Nob2NvbGF0LWNvdmVyJywgJ2Nob2NvbGF0LXpvb21hYmxlJywgJ2Nob2NvbGF0LXpvb21lZCcsICdjaG9jb2xhdC16b29taW5nLWluJywgJ2Nob2NvbGF0LXpvb21pbmctb3V0J107XG5cbiAgICAgICAgaWYgKE5vZGVMaXN0LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKGVsZW1lbnRzKSB8fCBIVE1MQ29sbGVjdGlvbi5wcm90b3R5cGUuaXNQcm90b3R5cGVPZihlbGVtZW50cykpIHtcbiAgICAgICAgICBlbGVtZW50cy5mb3JFYWNoKChlbCwgaSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pbWFnZXMucHVzaCh7XG4gICAgICAgICAgICAgIHRpdGxlOiBlbC5nZXRBdHRyaWJ1dGUoJ3RpdGxlJyksXG4gICAgICAgICAgICAgIHNyYzogZWwuZ2V0QXR0cmlidXRlKCdocmVmJyksXG4gICAgICAgICAgICAgIHNyY3NldDogZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcpLFxuICAgICAgICAgICAgICBzaXplczogZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXNpemVzJylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5vZmYoZWwsICdjbGljay5jaG9jb2xhdCcpO1xuICAgICAgICAgICAgdGhpcy5vbihlbCwgJ2NsaWNrLmNob2NvbGF0JywgZSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMuaW5pdChpKTtcbiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5pbWFnZXMgPSBlbGVtZW50cztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmNvbnRhaW5lciBpbnN0YW5jZW9mIEVsZW1lbnQgfHwgdGhpcy5zZXR0aW5ncy5jb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgIHRoaXMuZWxlbXMuY29udGFpbmVyID0gdGhpcy5zZXR0aW5ncy5jb250YWluZXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5lbGVtcy5jb250YWluZXIgPSBkb2N1bWVudC5ib2R5O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hcGkgPSB7XG4gICAgICAgICAgb3BlbjogaSA9PiB7XG4gICAgICAgICAgICBpID0gcGFyc2VJbnQoaSkgfHwgMDtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluaXQoaSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjbG9zZTogKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoYW5nZSgxKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHByZXY6ICgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoYW5nZSgtMSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnb3RvOiBpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9wZW4oaSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjdXJyZW50OiAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5jdXJyZW50SW1hZ2VJbmRleDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBvc2l0aW9uOiAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbih0aGlzLmVsZW1zLmltZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkZXN0cm95OiAoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kZXN0cm95KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXQ6IChwcm9wZXJ0eSwgdmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3NbcHJvcGVydHldID0gdmFsdWU7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXQ6IHByb3BlcnR5ID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzW3Byb3BlcnR5XTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldEVsZW06IG5hbWUgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWxlbXNbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBpbml0KGkpIHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgdGhpcy5tYXJrdXAoKTtcbiAgICAgICAgICB0aGlzLmF0dGFjaExpc3RlbmVycygpO1xuICAgICAgICAgIHRoaXMuc2V0dGluZ3MubGFzdEltYWdlSW5kZXggPSB0aGlzLmltYWdlcy5sZW5ndGggLSAxO1xuICAgICAgICAgIHRoaXMuc3RhdGUuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXR0aW5ncy5hZnRlckluaXRpYWxpemUuY2FsbCh0aGlzKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZChpKTtcbiAgICAgIH1cblxuICAgICAgbG9hZChpbmRleCkge1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGUudmlzaWJsZSkge1xuICAgICAgICAgIHRoaXMuc3RhdGUudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVsZW1zLm92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnY2hvY29sYXQtdmlzaWJsZScpO1xuICAgICAgICAgICAgdGhpcy5lbGVtcy53cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ2Nob2NvbGF0LXZpc2libGUnKTtcbiAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICB0aGlzLmVsZW1zLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdjaG9jb2xhdC1vcGVuJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5mdWxsU2NyZWVuKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5mdWxsU2NyZWVuT3BlbiA9IG9wZW5GdWxsU2NyZWVuKHRoaXMuZWxlbXMud3JhcHBlcik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5jdXJyZW50SW1hZ2VJbmRleCA9PT0gaW5kZXgpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbG9hZGVyVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLmVsZW1zLmxvYWRlci5jbGFzc0xpc3QuYWRkKCdjaG9jb2xhdC12aXNpYmxlJyk7XG4gICAgICAgIH0sIDEwMDApO1xuICAgICAgICBsZXQgZmFkZU91dFByb21pc2U7XG4gICAgICAgIGxldCBpbWFnZTtcbiAgICAgICAgbGV0IGZhZGVPdXRUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGZhZGVPdXRUaW1lciA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBmYWRlT3V0UHJvbWlzZSA9IHRyYW5zaXRpb25Bc1Byb21pc2UoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5lbGVtcy5pbWFnZUNhbnZhcy5jbGFzc0xpc3QucmVtb3ZlKCdjaG9jb2xhdC12aXNpYmxlJyk7XG4gICAgICAgICAgfSwgdGhpcy5lbGVtcy5pbWFnZUNhbnZhcyk7XG4gICAgICAgIH0sIDgwKTtcbiAgICAgICAgcmV0dXJuIGxvYWRJbWFnZSh0aGlzLmltYWdlc1tpbmRleF0pLnRoZW4obG9hZGVkSW1hZ2UgPT4ge1xuICAgICAgICAgIGltYWdlID0gbG9hZGVkSW1hZ2U7XG5cbiAgICAgICAgICBpZiAoZmFkZU91dFRpbWVyKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoZmFkZU91dFRpbWVyKTtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhZGVPdXRQcm9taXNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gaW5kZXggKyAxO1xuXG4gICAgICAgICAgaWYgKHRoaXMuaW1hZ2VzW25leHRJbmRleF0gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBsb2FkSW1hZ2UodGhpcy5pbWFnZXNbbmV4dEluZGV4XSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncy5jdXJyZW50SW1hZ2VJbmRleCA9IGluZGV4O1xuICAgICAgICAgIHRoaXMuZWxlbXMuZGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB0aGlzLnNldHRpbmdzLmRlc2NyaXB0aW9uLmNhbGwodGhpcyk7XG4gICAgICAgICAgdGhpcy5lbGVtcy5wYWdpbmF0aW9uLnRleHRDb250ZW50ID0gdGhpcy5zZXR0aW5ncy5wYWdpbmF0aW9uLmNhbGwodGhpcyk7XG4gICAgICAgICAgdGhpcy5hcnJvd3MoKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbihpbWFnZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVsZW1zLmxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdjaG9jb2xhdC12aXNpYmxlJyk7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobG9hZGVyVGltZXIpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXBwZWFyKGltYWdlKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgdGhpcy5lbGVtcy5jb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnY2hvY29sYXQtem9vbWFibGUnLCB0aGlzLnpvb21hYmxlKGltYWdlLCB0aGlzLmVsZW1zLndyYXBwZXIpKTtcbiAgICAgICAgICB0aGlzLnNldHRpbmdzLmFmdGVySW1hZ2VMb2FkLmNhbGwodGhpcyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBwb3NpdGlvbih7XG4gICAgICAgIG5hdHVyYWxIZWlnaHQsXG4gICAgICAgIG5hdHVyYWxXaWR0aFxuICAgICAgfSkge1xuICAgICAgICBjb25zdCBmaXRPcHRpb25zID0ge1xuICAgICAgICAgIGltZ0hlaWdodDogbmF0dXJhbEhlaWdodCxcbiAgICAgICAgICBpbWdXaWR0aDogbmF0dXJhbFdpZHRoLFxuICAgICAgICAgIGNvbnRhaW5lckhlaWdodDogdGhpcy5lbGVtcy5jb250YWluZXIuY2xpZW50SGVpZ2h0LFxuICAgICAgICAgIGNvbnRhaW5lcldpZHRoOiB0aGlzLmVsZW1zLmNvbnRhaW5lci5jbGllbnRXaWR0aCxcbiAgICAgICAgICBjYW52YXNXaWR0aDogdGhpcy5lbGVtcy5pbWFnZUNhbnZhcy5jbGllbnRXaWR0aCxcbiAgICAgICAgICBjYW52YXNIZWlnaHQ6IHRoaXMuZWxlbXMuaW1hZ2VDYW52YXMuY2xpZW50SGVpZ2h0LFxuICAgICAgICAgIGltYWdlU2l6ZTogdGhpcy5zZXR0aW5ncy5pbWFnZVNpemVcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIHdpZHRoLFxuICAgICAgICAgIGhlaWdodFxuICAgICAgICB9ID0gZml0KGZpdE9wdGlvbnMpO1xuICAgICAgICByZXR1cm4gdHJhbnNpdGlvbkFzUHJvbWlzZSgoKSA9PiB7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLmVsZW1zLmltYWdlV3JhcHBlci5zdHlsZSwge1xuICAgICAgICAgICAgd2lkdGg6IHdpZHRoICsgJ3B4JyxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LCB0aGlzLmVsZW1zLmltYWdlV3JhcHBlcik7XG4gICAgICB9XG5cbiAgICAgIGFwcGVhcihpbWFnZSkge1xuICAgICAgICB0aGlzLmVsZW1zLmltYWdlV3JhcHBlci5yZW1vdmVDaGlsZCh0aGlzLmVsZW1zLmltZyk7XG4gICAgICAgIHRoaXMuZWxlbXMuaW1nID0gaW1hZ2U7XG4gICAgICAgIHRoaXMuZWxlbXMuaW1nLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY2hvY29sYXQtaW1nJyk7XG4gICAgICAgIHRoaXMuZWxlbXMuaW1hZ2VXcmFwcGVyLmFwcGVuZENoaWxkKHRoaXMuZWxlbXMuaW1nKTtcbiAgICAgICAgY29uc3QgZmFkZUluUHJvbWlzZSA9IHRyYW5zaXRpb25Bc1Byb21pc2UoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZWxlbXMuaW1hZ2VDYW52YXMuY2xhc3NMaXN0LmFkZCgnY2hvY29sYXQtdmlzaWJsZScpO1xuICAgICAgICB9LCB0aGlzLmVsZW1zLmltYWdlQ2FudmFzKTtcbiAgICAgICAgcmV0dXJuIGZhZGVJblByb21pc2U7XG4gICAgICB9XG5cbiAgICAgIGNoYW5nZShzdGVwKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS52aXNpYmxlKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLnNldHRpbmdzLmxpbmtJbWFnZXMpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnpvb21PdXQoKTtcbiAgICAgICAgY29uc3QgcmVxdWVzdGVkSW1hZ2UgPSB0aGlzLnNldHRpbmdzLmN1cnJlbnRJbWFnZUluZGV4ICsgcGFyc2VJbnQoc3RlcCk7XG5cbiAgICAgICAgaWYgKHJlcXVlc3RlZEltYWdlID4gdGhpcy5zZXR0aW5ncy5sYXN0SW1hZ2VJbmRleCkge1xuICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLmxvb3ApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvYWQodGhpcy5zZXR0aW5ncy5maXJzdEltYWdlSW5kZXgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0ZWRJbWFnZSA8IHRoaXMuc2V0dGluZ3MuZmlyc3RJbWFnZUluZGV4KSB7XG4gICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MubG9vcCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9hZCh0aGlzLnNldHRpbmdzLmxhc3RJbWFnZUluZGV4KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMubG9hZChyZXF1ZXN0ZWRJbWFnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYXJyb3dzKCkge1xuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5sb29wKSB7XG4gICAgICAgICAgdGhpcy5lbGVtcy5sZWZ0LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgICAgIHRoaXMuZWxlbXMucmlnaHQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5zZXR0aW5ncy5saW5rSW1hZ2VzKSB7XG4gICAgICAgICAgdGhpcy5lbGVtcy5yaWdodC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnLCB0aGlzLnNldHRpbmdzLmN1cnJlbnRJbWFnZUluZGV4ICE9PSB0aGlzLnNldHRpbmdzLmxhc3RJbWFnZUluZGV4KTtcbiAgICAgICAgICB0aGlzLmVsZW1zLmxlZnQuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJywgdGhpcy5zZXR0aW5ncy5jdXJyZW50SW1hZ2VJbmRleCAhPT0gdGhpcy5zZXR0aW5ncy5maXJzdEltYWdlSW5kZXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZWxlbXMubGVmdC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICB0aGlzLmVsZW1zLnJpZ2h0LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5mdWxsU2NyZWVuT3Blbikge1xuICAgICAgICAgIGV4aXRGdWxsU2NyZWVuKCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zdGF0ZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IHByb21pc2VPdmVybGF5ID0gdHJhbnNpdGlvbkFzUHJvbWlzZSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5lbGVtcy5vdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ2Nob2NvbGF0LXZpc2libGUnKTtcbiAgICAgICAgfSwgdGhpcy5lbGVtcy5vdmVybGF5KTtcbiAgICAgICAgY29uc3QgcHJvbWlzZVdyYXBwZXIgPSB0cmFuc2l0aW9uQXNQcm9taXNlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmVsZW1zLndyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnY2hvY29sYXQtdmlzaWJsZScpO1xuICAgICAgICB9LCB0aGlzLmVsZW1zLndyYXBwZXIpO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3Byb21pc2VPdmVybGF5LCBwcm9taXNlV3JhcHBlcl0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZWxlbXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2Nob2NvbGF0LW9wZW4nKTtcbiAgICAgICAgICB0aGlzLnNldHRpbmdzLmFmdGVyQ2xvc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLmV2ZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIGVsZW1lbnQsXG4gICAgICAgICAgICBldmVudE5hbWVcbiAgICAgICAgICB9ID0gdGhpcy5ldmVudHNbaV07XG4gICAgICAgICAgdGhpcy5vZmYoZWxlbWVudCwgZXZlbnROYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5pbml0aWFsaXplZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmZ1bGxTY3JlZW5PcGVuKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5mdWxsU2NyZWVuT3BlbiA9IGV4aXRGdWxsU2NyZWVuKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldHRpbmdzLmN1cnJlbnRJbWFnZUluZGV4ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN0YXRlLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGF0ZS5pbml0aWFsaXplZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVsZW1zLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKC4uLnRoaXMuX2Nzc0NsYXNzZXMpO1xuICAgICAgICB0aGlzLmVsZW1zLndyYXBwZXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmVsZW1zLndyYXBwZXIpO1xuICAgICAgfVxuXG4gICAgICBtYXJrdXAoKSB7XG4gICAgICAgIHRoaXMuZWxlbXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2Nob2NvbGF0LW9wZW4nLCB0aGlzLnNldHRpbmdzLmNsYXNzTmFtZSk7XG5cbiAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuaW1hZ2VTaXplID09ICdjb3ZlcicpIHtcbiAgICAgICAgICB0aGlzLmVsZW1zLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdjaG9jb2xhdC1jb3ZlcicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZWxlbXMuY29udGFpbmVyICE9PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgICAgICAgdGhpcy5lbGVtcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnY2hvY29sYXQtaW4tY29udGFpbmVyJyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmVsZW1zLndyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5lbGVtcy53cmFwcGVyLnNldEF0dHJpYnV0ZSgnaWQnLCAnY2hvY29sYXQtY29udGVudC0nICsgdGhpcy5zZXR0aW5ncy5zZXRJbmRleCk7XG4gICAgICAgIHRoaXMuZWxlbXMud3JhcHBlci5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2Nob2NvbGF0LXdyYXBwZXInKTtcbiAgICAgICAgdGhpcy5lbGVtcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtcy53cmFwcGVyKTtcbiAgICAgICAgdGhpcy5lbGVtcy5vdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuZWxlbXMub3ZlcmxheS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2Nob2NvbGF0LW92ZXJsYXknKTtcbiAgICAgICAgdGhpcy5lbGVtcy53cmFwcGVyLmFwcGVuZENoaWxkKHRoaXMuZWxlbXMub3ZlcmxheSk7XG4gICAgICAgIHRoaXMuZWxlbXMubG9hZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuZWxlbXMubG9hZGVyLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY2hvY29sYXQtbG9hZGVyJyk7XG4gICAgICAgIHRoaXMuZWxlbXMud3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1zLmxvYWRlcik7XG4gICAgICAgIHRoaXMuZWxlbXMubGF5b3V0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuZWxlbXMubGF5b3V0LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY2hvY29sYXQtbGF5b3V0Jyk7XG4gICAgICAgIHRoaXMuZWxlbXMud3JhcHBlci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1zLmxheW91dCk7XG4gICAgICAgIHRoaXMuZWxlbXMudG9wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuZWxlbXMudG9wLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY2hvY29sYXQtdG9wJyk7XG4gICAgICAgIHRoaXMuZWxlbXMubGF5b3V0LmFwcGVuZENoaWxkKHRoaXMuZWxlbXMudG9wKTtcbiAgICAgICAgdGhpcy5lbGVtcy5jZW50ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5lbGVtcy5jZW50ZXIuc2V0QXR0cmlidXRlKCdjbGFzcycsICdjaG9jb2xhdC1jZW50ZXInKTtcbiAgICAgICAgdGhpcy5lbGVtcy5sYXlvdXQuYXBwZW5kQ2hpbGQodGhpcy5lbGVtcy5jZW50ZXIpO1xuICAgICAgICB0aGlzLmVsZW1zLmxlZnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5lbGVtcy5sZWZ0LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY2hvY29sYXQtbGVmdCcpO1xuICAgICAgICB0aGlzLmVsZW1zLmNlbnRlci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1zLmxlZnQpO1xuICAgICAgICB0aGlzLmVsZW1zLmltYWdlQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuZWxlbXMuaW1hZ2VDYW52YXMuc2V0QXR0cmlidXRlKCdjbGFzcycsICdjaG9jb2xhdC1pbWFnZS1jYW52YXMnKTtcbiAgICAgICAgdGhpcy5lbGVtcy5jZW50ZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtcy5pbWFnZUNhbnZhcyk7XG4gICAgICAgIHRoaXMuZWxlbXMuaW1hZ2VXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuZWxlbXMuaW1hZ2VXcmFwcGVyLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY2hvY29sYXQtaW1hZ2Utd3JhcHBlcicpO1xuICAgICAgICB0aGlzLmVsZW1zLmltYWdlQ2FudmFzLmFwcGVuZENoaWxkKHRoaXMuZWxlbXMuaW1hZ2VXcmFwcGVyKTtcbiAgICAgICAgdGhpcy5lbGVtcy5pbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgdGhpcy5lbGVtcy5pbWcuc2V0QXR0cmlidXRlKCdjbGFzcycsICdjaG9jb2xhdC1pbWcnKTtcbiAgICAgICAgdGhpcy5lbGVtcy5pbWFnZVdyYXBwZXIuYXBwZW5kQ2hpbGQodGhpcy5lbGVtcy5pbWcpO1xuICAgICAgICB0aGlzLmVsZW1zLnJpZ2h0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuZWxlbXMucmlnaHQuc2V0QXR0cmlidXRlKCdjbGFzcycsICdjaG9jb2xhdC1yaWdodCcpO1xuICAgICAgICB0aGlzLmVsZW1zLmNlbnRlci5hcHBlbmRDaGlsZCh0aGlzLmVsZW1zLnJpZ2h0KTtcbiAgICAgICAgdGhpcy5lbGVtcy5ib3R0b20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5lbGVtcy5ib3R0b20uc2V0QXR0cmlidXRlKCdjbGFzcycsICdjaG9jb2xhdC1ib3R0b20nKTtcbiAgICAgICAgdGhpcy5lbGVtcy5sYXlvdXQuYXBwZW5kQ2hpbGQodGhpcy5lbGVtcy5ib3R0b20pO1xuICAgICAgICB0aGlzLmVsZW1zLmNsb3NlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICB0aGlzLmVsZW1zLmNsb3NlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY2hvY29sYXQtY2xvc2UnKTtcbiAgICAgICAgdGhpcy5lbGVtcy50b3AuYXBwZW5kQ2hpbGQodGhpcy5lbGVtcy5jbG9zZSk7XG4gICAgICAgIHRoaXMuZWxlbXMuZGVzY3JpcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIHRoaXMuZWxlbXMuZGVzY3JpcHRpb24uc2V0QXR0cmlidXRlKCdjbGFzcycsICdjaG9jb2xhdC1kZXNjcmlwdGlvbicpO1xuICAgICAgICB0aGlzLmVsZW1zLmJvdHRvbS5hcHBlbmRDaGlsZCh0aGlzLmVsZW1zLmRlc2NyaXB0aW9uKTtcbiAgICAgICAgdGhpcy5lbGVtcy5wYWdpbmF0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICB0aGlzLmVsZW1zLnBhZ2luYXRpb24uc2V0QXR0cmlidXRlKCdjbGFzcycsICdjaG9jb2xhdC1wYWdpbmF0aW9uJyk7XG4gICAgICAgIHRoaXMuZWxlbXMuYm90dG9tLmFwcGVuZENoaWxkKHRoaXMuZWxlbXMucGFnaW5hdGlvbik7XG4gICAgICAgIHRoaXMuZWxlbXMuc2V0VGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIHRoaXMuZWxlbXMuc2V0VGl0bGUuc2V0QXR0cmlidXRlKCdjbGFzcycsICdjaG9jb2xhdC1zZXQtdGl0bGUnKTtcbiAgICAgICAgdGhpcy5lbGVtcy5zZXRUaXRsZS50ZXh0Q29udGVudCA9IHRoaXMuc2V0dGluZ3Muc2V0VGl0bGUoKTtcbiAgICAgICAgdGhpcy5lbGVtcy5ib3R0b20uYXBwZW5kQ2hpbGQodGhpcy5lbGVtcy5zZXRUaXRsZSk7XG4gICAgICAgIHRoaXMuZWxlbXMuZnVsbHNjcmVlbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgdGhpcy5lbGVtcy5mdWxsc2NyZWVuLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY2hvY29sYXQtZnVsbHNjcmVlbicpO1xuICAgICAgICB0aGlzLmVsZW1zLmJvdHRvbS5hcHBlbmRDaGlsZCh0aGlzLmVsZW1zLmZ1bGxzY3JlZW4pO1xuICAgICAgICB0aGlzLnNldHRpbmdzLmFmdGVyTWFya3VwLmNhbGwodGhpcyk7XG4gICAgICB9XG5cbiAgICAgIGF0dGFjaExpc3RlbmVycygpIHtcbiAgICAgICAgdGhpcy5vZmYoZG9jdW1lbnQsICdrZXlkb3duLmNob2NvbGF0Jyk7XG4gICAgICAgIHRoaXMub24oZG9jdW1lbnQsICdrZXlkb3duLmNob2NvbGF0JywgZSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT0gMzcpIHtcbiAgICAgICAgICAgICAgdGhpcy5jaGFuZ2UoLTEpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gMzkpIHtcbiAgICAgICAgICAgICAgdGhpcy5jaGFuZ2UoMSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PSAyNykge1xuICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgcmlnaHQgPSB0aGlzLmVsZW1zLndyYXBwZXIucXVlcnlTZWxlY3RvcignLmNob2NvbGF0LXJpZ2h0Jyk7XG4gICAgICAgIHRoaXMub2ZmKHJpZ2h0LCAnY2xpY2suY2hvY29sYXQnKTtcbiAgICAgICAgdGhpcy5vbihyaWdodCwgJ2NsaWNrLmNob2NvbGF0JywgKCkgPT4ge1xuICAgICAgICAgIHRoaXMuY2hhbmdlKCsxKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGxlZnQgPSB0aGlzLmVsZW1zLndyYXBwZXIucXVlcnlTZWxlY3RvcignLmNob2NvbGF0LWxlZnQnKTtcbiAgICAgICAgdGhpcy5vZmYobGVmdCwgJ2NsaWNrLmNob2NvbGF0Jyk7XG4gICAgICAgIHRoaXMub24obGVmdCwgJ2NsaWNrLmNob2NvbGF0JywgKCkgPT4ge1xuICAgICAgICAgIHRoaXMuY2hhbmdlKC0xKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub2ZmKHRoaXMuZWxlbXMuY2xvc2UsICdjbGljay5jaG9jb2xhdCcpO1xuICAgICAgICB0aGlzLm9uKHRoaXMuZWxlbXMuY2xvc2UsICdjbGljay5jaG9jb2xhdCcsIHRoaXMuY2xvc2UuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMub2ZmKHRoaXMuZWxlbXMuZnVsbHNjcmVlbiwgJ2NsaWNrLmNob2NvbGF0Jyk7XG4gICAgICAgIHRoaXMub24odGhpcy5lbGVtcy5mdWxsc2NyZWVuLCAnY2xpY2suY2hvY29sYXQnLCAoKSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUuZnVsbFNjcmVlbk9wZW4pIHtcbiAgICAgICAgICAgIGV4aXRGdWxsU2NyZWVuKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgb3BlbkZ1bGxTY3JlZW4odGhpcy5lbGVtcy53cmFwcGVyKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub2ZmKGRvY3VtZW50LCAnZnVsbHNjcmVlbmNoYW5nZS5jaG9jb2xhdCcpO1xuICAgICAgICB0aGlzLm9uKGRvY3VtZW50LCAnZnVsbHNjcmVlbmNoYW5nZS5jaG9jb2xhdCcsICgpID0+IHtcbiAgICAgICAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuZnVsbFNjcmVlbk9wZW4gPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLmZ1bGxTY3JlZW5PcGVuID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5zZXR0aW5ncy5jbG9zZU9uQmFja2dyb3VuZENsaWNrKSB7XG4gICAgICAgICAgdGhpcy5vZmYodGhpcy5lbGVtcy5vdmVybGF5LCAnY2xpY2suY2hvY29sYXQnKTtcbiAgICAgICAgICB0aGlzLm9uKHRoaXMuZWxlbXMub3ZlcmxheSwgJ2NsaWNrLmNob2NvbGF0JywgdGhpcy5jbG9zZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub2ZmKHRoaXMuZWxlbXMud3JhcHBlciwgJ2NsaWNrLmNob2NvbGF0Jyk7XG4gICAgICAgIHRoaXMub24odGhpcy5lbGVtcy53cmFwcGVyLCAnY2xpY2suY2hvY29sYXQnLCAoKSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaW5pdGlhbFpvb21TdGF0ZSA9PT0gbnVsbCB8fCAhdGhpcy5zdGF0ZS52aXNpYmxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5lbGVtcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnY2hvY29sYXQtem9vbWluZy1vdXQnKTtcbiAgICAgICAgICB0aGlzLnpvb21PdXQoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZWxlbXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2Nob2NvbGF0LXpvb21lZCcpO1xuICAgICAgICAgICAgdGhpcy5lbGVtcy5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnY2hvY29sYXQtem9vbWluZy1vdXQnKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub2ZmKHRoaXMuZWxlbXMuaW1hZ2VXcmFwcGVyLCAnY2xpY2suY2hvY29sYXQnKTtcbiAgICAgICAgdGhpcy5vbih0aGlzLmVsZW1zLmltYWdlV3JhcHBlciwgJ2NsaWNrLmNob2NvbGF0JywgZSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaW5pdGlhbFpvb21TdGF0ZSA9PT0gbnVsbCAmJiB0aGlzLmVsZW1zLmNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ2Nob2NvbGF0LXpvb21hYmxlJykpIHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB0aGlzLmVsZW1zLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdjaG9jb2xhdC16b29taW5nLWluJyk7XG4gICAgICAgICAgICB0aGlzLnpvb21JbihlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5lbGVtcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnY2hvY29sYXQtem9vbWVkJyk7XG4gICAgICAgICAgICAgIHRoaXMuZWxlbXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2Nob2NvbGF0LXpvb21pbmctaW4nKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMub24odGhpcy5lbGVtcy53cmFwcGVyLCAnbW91c2Vtb3ZlLmNob2NvbGF0JywgZSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaW5pdGlhbFpvb21TdGF0ZSA9PT0gbnVsbCB8fCAhdGhpcy5zdGF0ZS52aXNpYmxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMuZWxlbXMud3JhcHBlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICBjb25zdCBwb3MgPSB7XG4gICAgICAgICAgICB0b3A6IHJlY3QudG9wICsgd2luZG93LnNjcm9sbFksXG4gICAgICAgICAgICBsZWZ0OiByZWN0LmxlZnQgKyB3aW5kb3cuc2Nyb2xsWFxuICAgICAgICAgIH07XG4gICAgICAgICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5lbGVtcy53cmFwcGVyLmNsaWVudEhlaWdodDtcbiAgICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuZWxlbXMud3JhcHBlci5jbGllbnRXaWR0aDtcbiAgICAgICAgICBjb25zdCBpbWdXaWR0aCA9IHRoaXMuZWxlbXMuaW1nLndpZHRoO1xuICAgICAgICAgIGNvbnN0IGltZ0hlaWdodCA9IHRoaXMuZWxlbXMuaW1nLmhlaWdodDtcbiAgICAgICAgICBjb25zdCBjb29yZCA9IFtlLnBhZ2VYIC0gd2lkdGggLyAyIC0gcG9zLmxlZnQsIGUucGFnZVkgLSBoZWlnaHQgLyAyIC0gcG9zLnRvcF07XG4gICAgICAgICAgbGV0IG12dFggPSAwO1xuXG4gICAgICAgICAgaWYgKGltZ1dpZHRoID4gd2lkdGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhZGRpbmdYID0gdGhpcy5zZXR0aW5ncy56b29tZWRQYWRkaW5nWChpbWdXaWR0aCwgd2lkdGgpO1xuICAgICAgICAgICAgbXZ0WCA9IGNvb3JkWzBdIC8gKHdpZHRoIC8gMik7XG4gICAgICAgICAgICBtdnRYID0gKChpbWdXaWR0aCAtIHdpZHRoKSAvIDIgKyBwYWRkaW5nWCkgKiBtdnRYO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCBtdnRZID0gMDtcblxuICAgICAgICAgIGlmIChpbWdIZWlnaHQgPiBoZWlnaHQpIHtcbiAgICAgICAgICAgIGNvbnN0IHBhZGRpbmdZID0gdGhpcy5zZXR0aW5ncy56b29tZWRQYWRkaW5nWShpbWdIZWlnaHQsIGhlaWdodCk7XG4gICAgICAgICAgICBtdnRZID0gY29vcmRbMV0gLyAoaGVpZ2h0IC8gMik7XG4gICAgICAgICAgICBtdnRZID0gKChpbWdIZWlnaHQgLSBoZWlnaHQpIC8gMiArIHBhZGRpbmdZKSAqIG12dFk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5lbGVtcy5pbWcuc3R5bGUubWFyZ2luTGVmdCA9IC1tdnRYICsgJ3B4JztcbiAgICAgICAgICB0aGlzLmVsZW1zLmltZy5zdHlsZS5tYXJnaW5Ub3AgPSAtbXZ0WSArICdweCc7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm9uKHdpbmRvdywgJ3Jlc2l6ZS5jaG9jb2xhdCcsIGUgPT4ge1xuICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5pbml0aWFsaXplZCB8fCAhdGhpcy5zdGF0ZS52aXNpYmxlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZGVib3VuY2UoNTAsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpdE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgIGltZ0hlaWdodDogdGhpcy5lbGVtcy5pbWcubmF0dXJhbEhlaWdodCxcbiAgICAgICAgICAgICAgaW1nV2lkdGg6IHRoaXMuZWxlbXMuaW1nLm5hdHVyYWxXaWR0aCxcbiAgICAgICAgICAgICAgY29udGFpbmVySGVpZ2h0OiB0aGlzLmVsZW1zLndyYXBwZXIuY2xpZW50SGVpZ2h0LFxuICAgICAgICAgICAgICBjb250YWluZXJXaWR0aDogdGhpcy5lbGVtcy53cmFwcGVyLmNsaWVudFdpZHRoLFxuICAgICAgICAgICAgICBjYW52YXNXaWR0aDogdGhpcy5lbGVtcy5pbWFnZUNhbnZhcy5jbGllbnRXaWR0aCxcbiAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0OiB0aGlzLmVsZW1zLmltYWdlQ2FudmFzLmNsaWVudEhlaWdodCxcbiAgICAgICAgICAgICAgaW1hZ2VTaXplOiB0aGlzLnNldHRpbmdzLmltYWdlU2l6ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgICAgd2lkdGgsXG4gICAgICAgICAgICAgIGhlaWdodFxuICAgICAgICAgICAgfSA9IGZpdChmaXRPcHRpb25zKTtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24odGhpcy5lbGVtcy5pbWcpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLmVsZW1zLmNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdjaG9jb2xhdC16b29tYWJsZScsIHRoaXMuem9vbWFibGUodGhpcy5lbGVtcy5pbWcsIHRoaXMuZWxlbXMud3JhcHBlcikpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB6b29tYWJsZShpbWFnZSwgd3JhcHBlcikge1xuICAgICAgICBjb25zdCB3cmFwcGVyV2lkdGggPSB3cmFwcGVyLmNsaWVudFdpZHRoO1xuICAgICAgICBjb25zdCB3cmFwcGVySGVpZ2h0ID0gd3JhcHBlci5jbGllbnRIZWlnaHQ7XG4gICAgICAgIGNvbnN0IGlzSW1hZ2Vab29tYWJsZSA9IHRoaXMuc2V0dGluZ3MuYWxsb3dab29tICYmIChpbWFnZS5uYXR1cmFsV2lkdGggPiB3cmFwcGVyV2lkdGggfHwgaW1hZ2UubmF0dXJhbEhlaWdodCA+IHdyYXBwZXJIZWlnaHQpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICBjb25zdCBpc0ltYWdlU3RyZXRjaGVkID0gaW1hZ2UuY2xpZW50V2lkdGggPiBpbWFnZS5uYXR1cmFsV2lkdGggfHwgaW1hZ2UuY2xpZW50SGVpZ2h0ID4gaW1hZ2UubmF0dXJhbEhlaWdodDtcbiAgICAgICAgcmV0dXJuIGlzSW1hZ2Vab29tYWJsZSAmJiAhaXNJbWFnZVN0cmV0Y2hlZDtcbiAgICAgIH1cblxuICAgICAgem9vbUluKGUpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5pbml0aWFsWm9vbVN0YXRlID0gdGhpcy5zZXR0aW5ncy5pbWFnZVNpemU7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MuaW1hZ2VTaXplID0gJ25hdGl2ZSc7XG4gICAgICAgIHJldHVybiB0aGlzLnBvc2l0aW9uKHRoaXMuZWxlbXMuaW1nKTtcbiAgICAgIH1cblxuICAgICAgem9vbU91dChlKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MuaW1hZ2VTaXplID0gdGhpcy5zdGF0ZS5pbml0aWFsWm9vbVN0YXRlIHx8IHRoaXMuc2V0dGluZ3MuaW1hZ2VTaXplO1xuICAgICAgICB0aGlzLnN0YXRlLmluaXRpYWxab29tU3RhdGUgPSBudWxsO1xuICAgICAgICB0aGlzLmVsZW1zLmltZy5zdHlsZS5tYXJnaW4gPSAwO1xuICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbih0aGlzLmVsZW1zLmltZyk7XG4gICAgICB9XG5cbiAgICAgIG9uKGVsZW1lbnQsIGV2ZW50TmFtZSwgY2IpIHtcbiAgICAgICAgLy8gY29uc3QgZXZlbnROYW1lID0gdGhpcy5zZXR0aW5ncy5zZXRJbmRleCArICctJyArIGV2ZW50TmFtZVxuICAgICAgICBjb25zdCBsZW5ndGggPSB0aGlzLmV2ZW50cy5wdXNoKHtcbiAgICAgICAgICBlbGVtZW50LFxuICAgICAgICAgIGV2ZW50TmFtZSxcbiAgICAgICAgICBjYlxuICAgICAgICB9KTtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZS5zcGxpdCgnLicpWzBdLCB0aGlzLmV2ZW50c1tsZW5ndGggLSAxXS5jYik7XG4gICAgICB9XG5cbiAgICAgIG9mZihlbGVtZW50LCBldmVudE5hbWUpIHtcbiAgICAgICAgLy8gY29uc3QgZXZlbnROYW1lID0gdGhpcy5zZXR0aW5ncy5zZXRJbmRleCArICctJyArIGV2ZW50TmFtZVxuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuZXZlbnRzLmZpbmRJbmRleChldmVudCA9PiB7XG4gICAgICAgICAgcmV0dXJuIGV2ZW50LmVsZW1lbnQgPT09IGVsZW1lbnQgJiYgZXZlbnQuZXZlbnROYW1lID09PSBldmVudE5hbWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh0aGlzLmV2ZW50c1tpbmRleF0pIHtcbiAgICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLnNwbGl0KCcuJylbMF0sIHRoaXMuZXZlbnRzW2luZGV4XS5jYik7XG4gICAgICAgICAgdGhpcy5ldmVudHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgfVxuXG4gICAgY29uc3QgaW5zdGFuY2VzID0gW107XG5cbiAgICB3aW5kb3cuQ2hvY29sYXQgPSBmdW5jdGlvbiAoZWxlbWVudHMsIG9wdGlvbnMpIHtcbiAgICAgIGNvbnN0IHNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdHMsIHtcbiAgICAgICAgaW1hZ2VzOiBbXVxuICAgICAgfSwgb3B0aW9ucywge1xuICAgICAgICBzZXRJbmRleDogaW5zdGFuY2VzLmxlbmd0aFxuICAgICAgfSk7XG4gICAgICBjb25zdCBpbnN0YW5jZSA9IG5ldyBDaG9jb2xhdChlbGVtZW50cywgc2V0dGluZ3MpO1xuICAgICAgaW5zdGFuY2VzLnB1c2goaW5zdGFuY2UpO1xuICAgICAgcmV0dXJuIGluc3RhbmNlO1xuICAgIH07XG5cbn0oKSk7XG4iLCIoKGQsIHcpID0+IHtcbiAgaWYgKCF3aW5kb3cuSW50ZXJzZWN0aW9uT2JzZXJ2ZXIpIHtcbiAgICBjb25zb2xlLmxvZyhcIm9ic2VydmVycyBub3Qgc3VwcG9ydGVkXCIpO1xuICAgIGNvbnN0IG9ic2VydmVkQ29udGVudCA9IGQucXVlcnlTZWxlY3RvckFsbChcImZhZGVcIik7XG4gICAgb2JzZXJ2ZWRDb250ZW50LmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZShcImZhZGVcIik7XG4gICAgICBpZiAoZWxlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJmYWRlLWluXCIpKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZShcImZhZGUtaW5cIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChlbGVtLmNsYXNzTGlzdC5jb250YWlucyhcInN3aXBlLWxlZnRcIikpIHtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKFwic3dpcGUtbGVmdFwiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVsZW0uY2xhc3NMaXN0LmNvbnRhaW5zKFwic3dpcGUtcmlnaHRcIikpIHtcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKFwic3dpcGUtcmlnaHRcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChlbGVtLmNsYXNzTGlzdC5jb250YWlucyhcInN3aXBlLXVwXCIpKSB7XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZShcInN3aXBlLXVwXCIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGlmICghIXdpbmRvdy5JbnRlcnNlY3Rpb25PYnNlcnZlcikge1xuICAgIGNvbnN0IGFwcGVhck9wdGlvbnMgPSB7XG4gICAgICB0aHJlc2hvbGQ6IDAsXG4gICAgICByb290TWFyZ2luOiBgMHB4IDBweCAtMTUwcHggMHB4YCxcbiAgICB9O1xuXG4gICAgY29uc3QgYXBwZWFyT25TY3JvbGwgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoXG4gICAgICAoZW50cmllcywgYXBwZWFyT25TY3JvbGwpID0+IHtcbiAgICAgICAgZW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuICAgICAgICAgIGlmICghZW50cnkuaXNJbnRlcnNlY3RpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGVudHJ5LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJmYWRlLWluXCIpKSB7XG4gICAgICAgICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QuYWRkKFwiYXBwZWFyXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVudHJ5LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJzd2lwZS1sZWZ0XCIpKSB7XG4gICAgICAgICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QuYWRkKFwicG9zaXRpb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInN3aXBlLXJpZ2h0XCIpKSB7XG4gICAgICAgICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QuYWRkKFwicG9zaXRpb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInN3aXBlLXVwXCIpKSB7XG4gICAgICAgICAgICAgIGVudHJ5LnRhcmdldC5jbGFzc0xpc3QuYWRkKFwicG9zaXRpb25cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInN3aXBlLWRvd25cIikpIHtcbiAgICAgICAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5hZGQoXCJwb3NpdGlvblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFwcGVhck9uU2Nyb2xsLnVub2JzZXJ2ZShlbnRyeS50YXJnZXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgYXBwZWFyT3B0aW9uc1xuICAgICk7XG4gICAgY29uc3QgZmFkZXJzID0gZC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZhZGVcIik7XG4gICAgY29uc3Qgc3RhZ2dlcnMgPSBkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZmFkZS1zdGFnZ2VyXCIpO1xuXG4gICAgY29uc3Qgc2V0RGVsYXkgPSAoZ3JvdXAsIGR1cmF0aW9uLCBpKSA9PiB7XG4gICAgICBjb25zdCBzdHlsZSA9IGdldENvbXB1dGVkU3R5bGUoZ3JvdXApO1xuICAgICAgY29uc3QgaXNHcmlkID0gc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShcImRpc3BsYXlcIikgPT0gXCJncmlkXCI7XG5cbiAgICAgIGlmIChpc0dyaWQpIHtcbiAgICAgICAgbGV0IGNvbHMgPSBzdHlsZVxuICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zXCIpXG4gICAgICAgICAgLnNwbGl0KFwiIFwiKS5sZW5ndGg7XG5cbiAgICAgICAgcmV0dXJuIChpICUgY29scykgKiBkdXJhdGlvbjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGkgKiBkdXJhdGlvbjtcbiAgICB9O1xuXG4gICAgc3RhZ2dlcnMuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gMC4yNTtcblxuICAgICAgZ3JvdXAucXVlcnlTZWxlY3RvckFsbChcIi5mYWRlXCIpLmZvckVhY2goKGVsZW0sIGluZGV4KSA9PiB7XG4gICAgICAgIGVsZW0uc3R5bGUudHJhbnNpdGlvbkRlbGF5ID0gYCR7c2V0RGVsYXkoZ3JvdXAsIGR1cmF0aW9uLCBpbmRleCl9c2A7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGZhZGVycy5mb3JFYWNoKChmYWRlcikgPT4ge1xuICAgICAgYXBwZWFyT25TY3JvbGwub2JzZXJ2ZShmYWRlcik7XG4gICAgfSk7XG4gICAgZmFkZXJzLmZvckVhY2goKGZhZGVyKSA9PiB7XG4gICAgICBhcHBlYXJPblNjcm9sbC5vYnNlcnZlKGZhZGVyKTtcbiAgICB9KTtcbiAgfVxufSkoZG9jdW1lbnQsIHdpbmRvdyk7XG4iXX0=
